<!DOCTYPE html>
<html>
<head>
<style type="text/css">
     #map_canvas {
        width: 1024px;
        height: 700px;
      }
     #content-window {
        float: left;
        font-family: 'Roboto','sans-serif';
        height: 100%;
        line-height: 30px;
        padding-left: 10px;
        width: 19%;
      }
</style>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbIcltZ9OSGeUsKcT75lOHHOX5RC0wY5c&callback=initMap" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<script type="text/javascript">

function initMap() {
    var latlng = new google.maps.LatLng(52.24655, 0.11362);
    var myOptions = {
      zoom: 11,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    // Create an array of RWGPS route IDs
    var routeIDArray = new Array("13880632", "13880102", "17302925");
    //var colourArray = new Array("#FF0000", "#00FF00", "#0000FF", "#FFFFFF", "#000000", "#FFFF00", "#00FFFF", "#FF00FF");
    var colourArray = new Array("#FF0000", "#00FF00", "#0000FF");

    routeIDArray.forEach(function(routeID, index, routeIDArray) {
       console.log(routeID);
       console.log(index);
       addRouteToMap(routeID, colourArray[index]);
    });

    /*
    var url = "http://localhost:8000/13880632.json";
    var mypath1 = new Array();
       
    $.getJSON(url, function (data) {
      $.each(data.track_points, function(index, record) {
	mypath1.push(new google.maps.LatLng(record.y, record.x));
      });
        
      var polyline1 = new google.maps.Polyline({
        path: mypath1,
        strokeColor: '#ff0000',
        strokeOpacity: 1.0,
        strokeWeight: 3
      });

      polyline1.setMap(map);
   });

   //////////
    var url = "http://localhost:8000/13880102.json";
    var mypath2 = new Array();
       
    $.getJSON(url, function (data) {
      $.each(data.track_points, function(index, record) {
	//console.log(record.x);
	mypath2.push(new google.maps.LatLng(record.y, record.x));
      });
        
      var polyline2 = new google.maps.Polyline({
        path: mypath2,
        strokeColor: '#0000ff',
        strokeOpacity: 1.0,
        strokeWeight: 3
      });

      polyline2.setMap(map);

      var contentString = '<div id="content"><div id="siteNotice"></div>'+
      '<h1 id="firstHeading" class="firstHeading">Style Ride</h1>'+
      '<div id="bodyContent">'+
      '<p><a href="https://ridewithgps.com/routes/13880102">'+
      'https://ridewithgps.com/routes/13880102</a> '+
      '</p></div></div>';

      google.maps.event.addListener(polyline2, 'click', function (event) {
	infowindow.setContent(contentString);
        infowindow.setPosition(event.latLng);
   	infowindow.open(map, polyline2);
      });
   });

//////////
    var url = "http://localhost:8000/17302925.json";
    var mypath3 = new Array();
       
    $.getJSON(url, function (data) {
      $.each(data.track_points, function(index, record) {
	mypath3.push(new google.maps.LatLng(record.y, record.x));
      });
        
      var polyline3 = new google.maps.Polyline({
        path: mypath3,
        strokeColor: '#00ff00',
        strokeOpacity: 1.0,
        strokeWeight: 3
      });

      polyline3.setMap(map);
   });
	*/

    var infowindow = new google.maps.InfoWindow({
        //content: contentString,
    });

    function addRouteToMap (routeID, colour) {
      var url = "http://localhost:8000/" + routeID + ".json";
      console.log(url);
      var mypath = new Array();
       
      $.getJSON(url, function (data) {
        $.each(data.track_points, function(index, record) {
	  //console.log(record.x);
	  mypath.push(new google.maps.LatLng(record.y, record.x));
        });
        
        var polyline = new google.maps.Polyline({
          path: mypath,
          strokeColor: colour,
          strokeOpacity: 1.0,
          strokeWeight: 3
        });

        polyline.setMap(map);

        var contentString = '<div id="content"><div id="siteNotice"></div>'+
          '<h1 id="firstHeading" class="firstHeading">' + data.name + '</h1>'+
          '<div id="bodyContent">'+ data.description +
          '<p><a href="https://ridewithgps.com/routes/' + routeID + '">https://ridewithgps.com/routes/'+ routeID + '</a> '+
          '</p></div></div>';

        google.maps.event.addListener(polyline, 'click', function (event) {
	  infowindow.setContent(contentString);
          infowindow.setPosition(event.latLng);
   	  infowindow.open(map, polyline);
        });
     });
   }
}


    // google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <title>KML feature details</title>
  <body onload="initMap()">
  <div id="map_canvas"></div>
  <div id="content-window"></div>
</body>
</html>
